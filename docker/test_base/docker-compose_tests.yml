x-common: &_common
  network_mode: bridge
  environment:
    OUTPUT_DIR: /test_result
    CERTS_DIR: /certs
  volumes:
    - ../..:/otaclient_src:ro
    - ../../test_result:/test_result:rw
    - ./entry_point.sh:/entry_point.sh:ro

services:
  tester-ubuntu-18.04:
    build:
      context: .
      dockerfile: ubuntu-18.04.Dockerfile
      args:
        UBUNTU_BASE: ubuntu:18.04
    pull_policy: never
    image: ota-test_ubuntu1804
    container_name: ota-test_ubuntu1804
    <<: *_common

  tester-ubuntu-20.04:
    build:
      context: .
      args:
        UBUNTU_BASE: ubuntu:20.04
    pull_policy: never
    image: ota-test_ubuntu2004
    container_name: ota-test_ubuntu2004
    <<: *_common

  tester-ubuntu-22.04:
    build:
      context: .
      args:
        UBUNTU_BASE: ubuntu:22.04
    pull_policy: never
    image: ota-test_ubuntu2204
    container_name: ota-test_ubuntu2204
    <<: *_common
